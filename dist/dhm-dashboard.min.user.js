// ==UserScript==
// @name         DiamondHunt Mobile Dashboard
// @namespace    com.alorel.diamondhunt-dashboard
// @version      1.0.0
// @description  Showers you with the glory of Alorel
// @author       Alorel
// @include      http*://diamondhunt.app*
// @grant        unsafeWindow
// @grant        GM_getResourceText
// @grant        GM_info
// @run-at       document-end
// @homepage     https://github.com/Alorel/dhm-dashboard
// @resource     bs_css https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css
// @resource     tooltip_css https://cdnjs.cloudflare.com/ajax/libs/balloon-css/0.5.0/balloon.min.css
// @icon         https://diamondhunt.app/images/ruby.png
// @require      https://polyfill.io/v3/polyfill.js?features=es5,es6,es7,default
// @require https://cdn.jsdelivr.net/npm/bluebird@3.5.3/js/browser/bluebird.min.js
// @require https://cdn.jsdelivr.net/npm/rxjs@6.3.3/bundles/rxjs.umd.min.js
// @require https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js
// @require https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.min.js
// ==/UserScript==

!function(e,t,n,r,i,o){!function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=n,i.c=r,i.d=function(t,n,r){i.o(t,n)||e.defineProperty(t,n,{enumerable:!0,get:r})},i.r=function(n){void 0!==t&&t.toStringTag&&e.defineProperty(n,t.toStringTag,{value:"Module"}),e.defineProperty(n,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=e.create(null);if(i.r(r),e.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(t,n){return e.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=7)}([function(e,t){e.exports=rxjs.operators},function(e,t){e.exports=_},function(e,t){e.exports=rxjs},function(e,t){e.exports=moment},function(e,t){e.exports=":host{background:transparent;display:inline-block;font-size:12px;margin-top:5px;margin-bottom:5px}img.item{height:1em;width:1em}.item{display:inline-block;margin-left:3.33px}.item:first-child,.item:empty:not(input){margin-left:0}span.item:empty{display:none}\n"},function(e,t){e.exports=":host{display:block;background:rgba(0,0,0,0.5);padding:5px;border-radius:5px}hr{margin:0;border-width:1px 0 0 0;border-color:#fff}ul.inline{padding-left:0;margin-top:5px;margin-bottom:5px;margin-left:-5px;list-style:none}ul.inline>li{display:inline-block;padding-right:5px;padding-left:5px}@media (min-width: 1000px){:host{position:fixed;top:5px;left:5px;width:230px;box-shadow:2px 2px 10px 0 #000;background:rgba(0,0,0,0.2);border:1px ridge silver}}@media (min-width: 1100px){:host{width:280px}}@media (min-width: 1200px){:host{width:330px}}@media (min-width: 1300px){:host{width:380px}}@media (min-width: 1400px){:host{width:430px}}@media (min-width: 1500px){:host{width:480px}}@media (min-width: 1600px){:host{width:530px}}@media (min-width: 1700px){:host{width:580px}}@media (min-width: 1800px){:host{width:630px}}@media (min-width: 1900px){:host{width:680px}}\n"},function(a,u,p){"use strict";p.r(u);var l=function(t,n){return(l=e.setPrototypeOf||{__proto__:[]}instanceof o&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};function c(t,n){function r(){this.constructor=t}l(t,n),t.prototype=null===n?e.create(n):(r.prototype=n.prototype,new r)}function s(t,n,r,i){var o,a=arguments.length,u=a<3?n:null===i?i=e.getOwnPropertyDescriptor(n,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,n,r,i);else for(var p=t.length-1;p>=0;p--)(o=t[p])&&(u=(a<3?o(u):a>3?o(n,r,u):o(n,r))||u);return a>3&&u&&e.defineProperty(n,r,u),u}function f(e){var n="function"==typeof t&&e[t.iterator],r=0;return n?n.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function d(e,n){var r="function"==typeof t&&e[t.iterator];if(!r)return e;var i,o,a=r.call(e),u=[];try{for(;(void 0===n||n-- >0)&&!(i=a.next()).done;)u.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return u}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}var h={getResourceText:GM_getResourceText,info:GM_info,unsafeWindow:i};function g(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return"string"==typeof e&&(e=n.createElement(e)),(t=e.classList).add.apply(t,m(r)),e}function y(e,t,r){var i=n.createElement(e);return i[r?"innerHTML":"innerText"]=t,i}function v(t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),function(i,o,a){a||(a=e.getOwnPropertyDescriptor(i,o));var u=a.get;if(!u)throw new r("@LazyGetter can only decorate getters!");if(!a.configurable)throw new r("@LazyGetter target must be configurable");a.get=function(){var r=u.apply(this,arguments),p={configurable:!n,enumerable:a.enumerable,value:r},l=e.getPrototypeOf(i)===Function.prototype;return(l||t)&&e.defineProperty(i,o,p),l||e.defineProperty(this,o,p),r}}}function b(e,t){var r=n.createElement("style");return r.innerText=t,e.appendChild(r),e}n.createElement("div");var w=function(){function t(e,t){this.imgUrl=e,this.label=t||"";var n=this.getOnClick();n&&this.root.addEventListener("click",n),b(this.root,p(4)),this.root.appendChild(this.innerContainer),this.innerContainer.appendChild(this.img),this.innerContainer.appendChild(this.labelElement)}return e.defineProperty(t.prototype,"container",{get:function(){return n.createElement("div")},enumerable:!0,configurable:!0}),e.defineProperty(t.prototype,"img",{get:function(){return g("img","item")},enumerable:!0,configurable:!0}),e.defineProperty(t.prototype,"imgUrl",{get:function(){return this.img.src},set:function(e){this.img.src=e},enumerable:!0,configurable:!0}),e.defineProperty(t.prototype,"innerContainer",{get:function(){return g("span","btn","btn-sm","btn-dark")},enumerable:!0,configurable:!0}),e.defineProperty(t.prototype,"label",{get:function(){return this.labelElement.innerHTML},set:function(e){this.labelElement.innerHTML=e},enumerable:!0,configurable:!0}),e.defineProperty(t.prototype,"labelElement",{get:function(){return g("span","item")},enumerable:!0,configurable:!0}),e.defineProperty(t.prototype,"root",{get:function(){return this.container.attachShadow({mode:"closed"})},enumerable:!0,configurable:!0}),t.prototype.getOnClick=function(){},s([v()],t.prototype,"container",null),s([v()],t.prototype,"img",null),s([v()],t.prototype,"innerContainer",null),s([v()],t.prototype,"labelElement",null),s([v()],t.prototype,"root",null),t}();function x(){return n.createElement("hr")}function C(e,t){return y("span",e,t)}function k(e){h.unsafeWindow.navigate(e)}var S=p(1),P=p(0),O=p(2);function L(t){return e(O.timer)(0,1e3).pipe(e(P.map)(function(){return h.unsafeWindow[t]}))}function E(){return e(P.distinctUntilChanged)(S.isEqual)}E.cloned=function(){return e(P.distinctUntilChanged)(function(t,n){return e(S.isEqual)(e(S.cloneDeep)(t),n)})};var T=t("value"),N=function(t){function n(n,r){var i=t.call(this,n,r)||this;return i.innerContainer.appendChild(i.valueElement),b(i.root,h.getResourceText("bs_css")),i.initTextObservable().subscribe(function(e){i.valueElement.innerHTML=e}),setTimeout(function(){var t=i.computeValue();e(O.isObservable)(t)?t.pipe(E()).subscribe(function(e){i.value=e}):e(O.timer)(0,1e3).pipe(e(P.map)(function(){return i.computeValue()}),E()).subscribe(function(){i.value=i.computeValue()})},1),i}var r;return c(n,t),e.defineProperty(n.prototype,"value",{get:function(){return this[T].value},set:function(e){this[T].next(e)},enumerable:!0,configurable:!0}),e.defineProperty(n.prototype,"valueElement",{get:function(){return g(C("??"),"item")},enumerable:!0,configurable:!0}),e.defineProperty(n.prototype,r=T,{get:function(){return new O.BehaviorSubject(null)},enumerable:!0,configurable:!0}),n.prototype.getValueObservable=function(){return this[T].pipe(e(P.distinctUntilChanged)(),e(P.shareReplay)())},n.prototype.initTextObservable=function(){return this.getValueObservable().pipe(e(P.map)(this.valueStringifier,this),e(P.startWith)("??"),e(P.distinctUntilChanged)())},n.prototype.valueStringifier=function(e){return null==e?"??":e.toLocaleString()},s([v()],n.prototype,"valueElement",null),s([v()],n.prototype,r,null),n}(w),_=/\.(png|gif)$/g,M=function(t){function n(n,r){var i=t.call(this,"/images/"+n,"")||this;return i.valueOb$=r,i.shouldHideFromUI().subscribe(function(e){if(e)i.root.appendChild(i.hideStyleEl);else try{i.root.removeChild(i.hideStyleEl)}catch(e){}}),b(i.root,h.getResourceText("tooltip_css")),i.innerContainer.setAttribute("data-balloon-pos","up"),i.innerContainer.setAttribute("data-balloon",e(S.startCase)(n.toString().replace(_,""))),i}return c(n,t),e.defineProperty(n.prototype,"hideStyleEl",{get:function(){return y("style",":host{display:none!important}")},enumerable:!0,configurable:!0}),n.fromName=function(e){return new n(e+".png",L(e))},n.fromNameClick=function(e){return n.fromName(e).addOnClick(function(){h.unsafeWindow.clicksItem(e)})},n.fromNameNav=function(e,t){return n.fromName(e).nav(t)},n.prototype.addOnClick=function(e){var t=this;return this.addPointer(),this.root.addEventListener("click",e,{passive:!0}),this.addOnClick=function(){return t},this},n.prototype.addOnRightClick=function(e){var t=this;return this.addPointer(),this.addOnClick=function(){return t},this.root.addEventListener("contextmenu",e),this},n.prototype.addSecondaryTooltip=function(e){var t=this;this.valueElement.setAttribute("data-balloon-pos","down");var n=function(e){return t.valueElement.setAttribute("data-balloon",e),t};return this.addSecondaryTooltip=n,n(e),this},n.prototype.extractDomElement=function(){return this.container},n.prototype.forceState=function(e){var t=this.innerContainer.classList;return t.remove("btn-dark"),t.add(e),this},n.prototype.nav=function(e){return this.addOnClick(function(){k(e)})},n.prototype.shouldHideFromUI=function(){return this.valueOb$.pipe(e(P.map)(U),e(P.distinctUntilChanged)())},n.prototype.computeValue=function(){return this.valueOb$},n.prototype.addPointer=function(){b(this.root,":host{cursor:pointer}"),this.addPointer=S.noop},s([v()],n.prototype,"hideStyleEl",null),n}(N);function U(e){return e<=0}var R=["bronzeBars","ironBars","silverBars","goldBars","promethiumBars","titaniumBars"].map(M.fromNameClick);R.push(M.fromNameNav("ironBucket","crafting"),M.fromName("lava"));var B=["fishBones","bones","ashes","iceBones"].map(function(e){return M.fromNameClick(e)});B.unshift(new M("bonemealBin.png",L("bonemeal")));var I=["chicken","cheese","honey","potato","apple","caveCarrot","shrimp","sardine","tuna","shark","shrimp2","sardine2","tuna2","swordfish2","shark2","swordfish","whale","whale2","rainbowFish","rainbowFish2"].map(M.fromNameClick);function V(){k("brew")}function A(e){e.preventDefault(),k("brewing")}I.unshift(M.fromNameNav("energy","exploring"));var W=["dottedGreenLeaf","greenLeaf","limeLeaf","goldLeaf","crystalLeaf","redMushroom"].map(function(e){return M.fromName(e).addOnClick(V).addOnRightClick(A)});function D(e){return!!e&&(e.click(),!0)}var F=["logs","oakLogs","entLogs","willowLogs","mapleLogs","redwoodLogs","pineLogs","kindle","lavaKindle","hauntedLogs"].map(function(e){return M.fromName(e).addOnClick(function(){!function(e){if(!D(n.querySelector(e)))throw new r('Unable to click selector "'+e+'"')}("#dialogue-oven-"+e+">tbody>tr[onclick]")})}),j=new(function(t){function n(){var e=t.call(this,"/images/oil_lighter.png")||this;return b(e.root,h.getResourceText("bs_css")),e}return c(n,t),n.prototype.computeValue=function(){return e(O.combineLatest)(L("oilIn"),L("oilOut")).pipe(e(P.map)(function(e){var t=d(e,2);return t[0]-t[1]}),e(P.distinctUntilChanged)())},n.prototype.getOnClick=function(){return function(){k("miningOres")}},n.prototype.valueStringifier=function(e){return'<span class="text-'+(e?"success":"danger")+'">'+((e?"+":"-")+(e||0).toLocaleString())+"</span>"},n}(N)),H=[M.fromName("bloodCrystals").nav("shop"),j,M.fromName("oil").nav("miningOres")];H.push.apply(H,m(m(["sapphire","emerald","ruby","diamond","bloodDiamond","stone","copper","iron","silver","gold","promethium","titanium"],e(S.range)(1,4).map(function(e){return"geode"+e})).map(function(e){return M.fromNameClick(e)})));var z=p(3),G=["superCompostPotion","woodcuttingUpgradePotion"].concat(["furnaceSpeedPotion","treeCompostPotion","woodcuttingXpPotion","seedFinderPotion","compostPotion","fastCompostPotion","farmingXpPotion","fishingSpeedPotion","baitPotion","exploringSpeedPotion","oilPotion","coinPotion"]).map(function(t){var n=M.fromName(t).addOnClick(function(){h.unsafeWindow.clicksItem(t)});return L(t).pipe(e(P.map)(function(e){return 1e3*h.unsafeWindow.getPotionTimer(t)*e}),e(P.distinctUntilChanged)(),e(P.map)(function(t){return e(z.duration)(t).humanize()})).subscribe(function(e){n.addSecondaryTooltip("Enough for "+e)}),n});G.push.apply(G,m(["hpCombatPotion","freezeCombatPotion"].map(function(t){var n=M.fromName(t).forceState("btn-light"),r=L("monsterName"),i=L(t+"Used");return e(O.combineLatest)(r,i).pipe(e(P.map)(function(e){var t=d(e,2),n=t[0],r=t[1];return!n||"none"===n||!!r}),e(P.distinctUntilChanged)()).subscribe(function(e){n.innerContainer.classList[e?"add":"remove"]("disabled")}),n})));var q=["rawRainbowFish","rawWhale","rawShark","rawSwordfish","rawTuna","rawChicken","rawSardine","rawShrimp"].map(M.fromNameClick);q.unshift(M.fromName("heat").addOnClick(function(){h.unsafeWindow.clicksItem(h.unsafeWindow.getOvenType())})),q.unshift(M.fromNameNav("bait","cooking"));var $={appleTreeSeeds:216e5,crystalLeafSeeds:108e5,dottedGreenLeafSeeds:9e5,goldLeafSeeds:72e5,greenLeafSeeds:18e5,hauntedTreeSeeds:432e5,limeLeafSeeds:36e5,mapleTreeSeeds:216e5,oakTreeSeeds:72e5,pineTreeSeeds:36e6,redMushroomSeeds:9e5,redwoodTreeSeeds:288e5,treeSeeds:36e5,willowTreeSeeds:144e5},X=e(S.sortBy)(e.keys($),function(e){return $[e]}),K=function(t){function n(e,n){var r=t.call(this,e,n)||this,i=r.innerContainer.classList;return r.isReady().subscribe(function(e){e?(i.remove("btn-dark"),i.add.apply(i,m(r.getReadyClasses()))):(i.remove.apply(i,m(r.getReadyClasses())),i.add("btn-dark"))}),r}return c(n,t),n.prototype.isReady=function(){return this.getValueObservable().pipe(e(P.map)(this.readyMapper,this),e(P.distinctUntilChanged)())},n.prototype.getReadyClasses=function(){return["btn-success"]},n}(N);var J=new(function(t){function n(){var n=t.call(this,"/images/clock_white.png")||this;return b(n.root,h.getResourceText("tooltip_css")),n.innerContainer.setAttribute("data-balloon-pos","up"),n.computeValue().subscribe(function(t){var r=e(z.duration)(t),i=[r.hours(),r.minutes(),r.seconds()];r.days()&&i.unshift(r.days());var o=i.map(function(t){return e(S.padStart)(t.toString(),2,"0")}).join(":");n.innerContainer.setAttribute("data-balloon",o)}),n}return c(n,t),n.prototype.computeValue=function(){return(t=e(S.range)(1,7).map(function(e){return L("farmUnlocked"+e)}),e(O.combineLatest)(t).pipe(e(P.map)(function(e){var t,n,r=0;try{for(var i=f(e),o=i.next();!o.done;o=i.next())r+=o.value}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return Math.max(1,r)}),e(P.distinctUntilChanged)())).pipe(e(P.switchMap)(function(t){return e(O.combineLatest)(X.map(L)).pipe(e(P.map)(function(e){for(var n=0,r=0;r<e.length;r++)n+=e[r]*$[X[r]];return Math.floor(n/t)}))}),e(P.distinctUntilChanged)());var t},n.prototype.getOnClick=function(){return function(){k("farming")}},n.prototype.getReadyClasses=function(){return["btn-danger"]},n.prototype.readyMapper=function(e){return 0===e},n.prototype.valueStringifier=function(t){return this.readyMapper(t)?"Done":e(z.duration)(t).humanize()},n}(K)),Q=X.map(function(e){return M.fromNameNav(e,"farming")});Q.push(J),Q.unshift.apply(Q,m(["fishBones","bones","ashes","iceBones"].map(function(e){return M.fromNameClick(e)}))),Q.unshift(new M("bonemealBin.png",L("bonemeal")));var Y=new(function(t){function n(){return t.call(this,"/images/craftingSkill.png")||this}return c(n,t),n.prototype.computeValue=function(){return e(O.combineLatest)(L("smeltingCurrentOreTo"),L("smeltingCurrentOreAt")).pipe(e(P.map)(function(e){var t=d(e,2);return t[0]-t[1]}))},n.prototype.getOnClick=function(){return function(){k("crafting")}},n.prototype.readyMapper=function(e){return 0===e},n.prototype.valueStringifier=function(e){return-1===e?"??":this.readyMapper(e)?"ready":t.prototype.valueStringifier.call(this,e)},n}(K));function Z(e){return 1e3*e}var ee=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return c(n,t),n.format=function(t){return e(S.padStart)(t.toString(),2,"0")},n.prototype.readyMapper=function(e){return 0===e},n.prototype.valueStringifier=function(t){switch(t){case 0:return"ready";case-1:return"??";default:var r=e(z.duration)(t),i=[r.hours(),r.minutes(),r.seconds()],o=r.days();return o&&i.unshift(o),i.map(n.format).join(":")}},n}(K),te=new(function(t){function n(){return t.call(this,"/images/exploringSkill.png")||this}return c(n,t),n.prototype.computeValue=function(){return L("explorerCooldown").pipe(e(P.map)(Z))},n.prototype.getOnClick=function(){return function(){k("exploring")}},n}(ee)),ne=function(t){function n(e,n,r){var i=t.call(this,e,r)||this;return i.prefix=n,i}return c(n,t),n.prototype.getAvailablePatches=function(){var t=this,n=e(S.range)(1,7).map(function(e){return L(t.prefix+"Unlocked"+e)});return O.combineLatest.apply(void 0,m(n)).pipe(e(P.map)(function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n+1);return t}),E())},n.prototype.computeValue=function(){var t=this;return this.getAvailablePatches().pipe(e(P.switchMap)(function(e){return O.combineLatest.apply(void 0,m(e.map(function(e){return L(t.prefix+"Timer"+e)})))}),e(P.map)(function(e){var t=e.map(re).filter(ie);return t.length?Math.min.apply(Math,m(t)):-1}))},n}(ee);function re(e){return 1===e?0:e>0?1e3*e:-1}function ie(e){return-1!==e}var oe=new(function(e){function t(){return e.call(this,"/images/farmingSkill.png","tree")||this}return c(t,e),t.prototype.getOnClick=function(){return function(){k("farming")}},t}(ne)),ae=new(function(e){function t(){return e.call(this,"/images/woodcuttingSkill.png","tree")||this}return c(t,e),t.prototype.getOnClick=function(){return function(){k("woodcutting")}},t}(ne));p.d(u,"initUI",function(){return le});var ue=n.createElement("div"),pe=function(e,t){void 0===t&&(t=x);var r=0,i=e.attachShadow({mode:"closed"});function o(){for(var e,o,a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];r++&&i.appendChild(t());var p=g("ul","inline"),l=function(e){try{var t=n.createElement("li");(r=e)&&"function"==typeof r.shouldHideFromUI&&"function"==typeof r.extractDomElement?(e.shouldHideFromUI().subscribe(function(e){t.style.display=e?"none":null}),t.appendChild(e.extractDomElement())):function(e){return!!e&&e instanceof w}(e)?t.appendChild(e.container):t.appendChild(e),p.appendChild(t)}catch(t){throw console.error(e),t}var r};try{for(var c=f(a),s=c.next();!s.done;s=c.next())l(s.value)}catch(t){e={error:t}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(e)throw e.error}}i.appendChild(p)}return b(i,h.getResourceText("bs_css")),b(i,p(5)),o.root=i,o}(ue);function le(e){var t,n;t=ue,(n=e).parentNode.insertBefore(t,n.nextSibling)}pe(te,Y,ae,oe),pe.apply(void 0,m(H)),pe.apply(void 0,m(Q)),pe.apply(void 0,m(B)),pe.apply(void 0,m(R)),pe.apply(void 0,m(F)),pe.apply(void 0,m(W)),pe.apply(void 0,m(G)),pe.apply(void 0,m(q)),pe.apply(void 0,m(I));try{var ce=h.info.script,se=ce.version,fe=ce.name,de=ce.homepage;pe.root.appendChild(n.createElement("hr"));var me=g("div","text-center","small");me.appendChild(C(fe+" v"+se+" by "));var he=y("a","Alorel");he.href=de,he.target="_blank",me.appendChild(he),pe.root.appendChild(me)}catch(e){}k("woodcutting"),k("farming"),k("exploring"),k("mining"),k("cooking"),k("crafting"),k("main"),k("brew"),k("brewing")},function(e,t,r){"use strict";r.r(t);var i=setInterval(function(){var e,t=n.getElementById("top-status-bar");t&&((e=n.getElementById("game-screen"))&&"none"!==getComputedStyle(e).display)&&(r(6).initUI(t),clearInterval(i))},1e3),o=n.querySelector('link[rel="icon"]');o&&(o.href="/images/ruby.png"),(o=n.querySelector('body link[rel="icon"]'))&&n.head.appendChild(o)}])}(Object,Symbol,document,Error,unsafeWindow,Array);